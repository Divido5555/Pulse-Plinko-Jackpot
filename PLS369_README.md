# PLS369 Eternal Plinko System

## Overview

The **PLS369 Eternal Plinko** is a fully on-chain, tokenized Plinko game designed for the PLS369 DAO ecosystem. Unlike traditional casino games, this system:

- **Tokenized**: Uses PLS369 token for all gameplay (entry fees, prizes, jackpots)
- **DAO-Governed**: The DAO treasury acts as the "house" and receives 4% of all entry fees
- **Configurable Until Finalized**: Owner can adjust parameters until `finalize()` is called
- **On-Chain Randomness**: Uses blockhash, timestamp, sender, and play count for randomness
- **Zero PLS Usage**: No native PLS required (except gas), all payouts in PLS369

---

## Architecture

```
┌─────────────────────────────────────────────────────────────┐
│                    PLS369 DAO Ecosystem                     │
├─────────────────────────────────────────────────────────────┤
│                                                              │
│  ┌──────────────┐         ┌─────────────────────────────┐  │
│  │ PLS369Token  │────────▶│  369M Fixed Supply          │  │
│  │              │         │  - No taxes, no burns       │  │
│  │  ERC-20      │         │  - Distributed by DAO       │  │
│  └──────────────┘         └─────────────────────────────┘  │
│         │                                                    │
│         │ (players buy & hold)                              │
│         │                                                    │
│         ▼                                                    │
│  ┌──────────────────────────────────────────────────────┐  │
│  │          PlinkoGame369 Contract                      │  │
│  │  ┌────────────────────────────────────────────────┐ │  │
│  │  │  Entry: 10 PLS369 per play                     │ │  │
│  │  │  Split: 40% main | 10% mini | 4% DAO | 3% dev  │ │  │
│  │  └────────────────────────────────────────────────┘ │  │
│  │                                                      │  │
│  │  ┌─────────────┐   ┌─────────────┐                 │  │
│  │  │ Main Jackpot│   │ Mini Jackpot│                 │  │
│  │  │ (Slot 10)   │   │ (Slots 2,16)│                 │  │
│  │  └─────────────┘   └─────────────┘                 │  │
│  │                                                      │  │
│  │  Prize Slots: 3, 7, 11, 15, 18                     │  │
│  │  Loser Slots: All others                           │  │
│  └──────────────────────────────────────────────────────┘  │
│         │                                                    │
│         │ (uses on-chain randomness)                        │
│         │                                                    │
│         ▼                                                    │
│  ┌──────────────────────────────────────────────────────┐  │
│  │           On-Chain Randomness                        │  │
│  │  - blockhash(block.number - 1)                       │  │
│  │  - block.timestamp + msg.sender + playCount          │  │
│  │  - No external oracle required                       │  │
│  └──────────────────────────────────────────────────────┘  │
│                                                              │
└─────────────────────────────────────────────────────────────┘
```

---

## Contracts

### PLS369Token.sol

**Fixed-supply ERC-20 token for the ecosystem.**

- **Total Supply**: 369,000,000 PLS369
- **Decimals**: 18
- **Features**: Standard ERC-20, no taxes, no burns
- **Distribution**: Managed off-chain by DAO

### PlinkoGame369.sol

**Eternal Plinko game contract.**

- **Entry Price**: 10 PLS369 per play (fixed)
- **Randomness**: On-chain (blockhash + timestamp + sender + playCount)
- **Economy**: Token-based, no PLS required
- **Configurable**: Parameters adjustable until `finalize()` is called

---

## Game Mechanics

### Entry & Payouts

**Entry Fee**: 10 PLS369 per play

**Per-Play Distribution**:
- 40% → Main Jackpot pool
- 10% → Mini Jackpot pool
- 4% → DAO Treasury (claimable)
- 3% → Dev Wallet (claimable)
- 43% → Prize Pool (remainder)

### Prize Slots (20 slots, 0-indexed)

| Slot | Type | Payout |
|------|------|--------|
| 0, 1 | Loser | 0x |
| **2** | **Mini Jackpot** | **50% of pot** |
| **3** | **Prize** | **3.0x** |
| 4, 5, 6 | Loser | 0x |
| **7** | **Prize** | **2.0x** |
| 8, 9 | Loser | 0x |
| **10** | **Main Jackpot** | **50% of pot** |
| **11** | **Prize** | **5.0x** |
| 12, 13, 14 | Loser | 0x |
| **15** | **Prize** | **2.0x** |
| **16** | **Mini Jackpot** | **50% of pot** |
| 17 | Loser | 0x |
| **18** | **Prize** | **2.0x** |
| 19 | Loser | 0x |

### Jackpot Logic

**Main Jackpot (Slot 10)**:
- **Odds**: 1 in 33,333 (after landing on slot 10)
- **Payout**:
  - 50% → Winner
  - 20% → DAO Treasury
  - 30% → Stays in jackpot (reset)

**Mini Jackpot (Slots 2 and 16)**:
- **Odds**: 1 in 4,762 (after landing on slot 2 or 16)
- **Payout**:
  - 50% → Winner
  - 10% → Dev Wallet
  - 40% → Stays in jackpot (reset)

---

## Randomness System

The game uses **on-chain randomness** generated by the `_generateRandomness()` function in the contract.

### How It Works

1. Each `play()` call generates randomness using on-chain data
2. Randomness is derived from: `blockhash(block.number - 1)`, `block.timestamp`, `msg.sender`, `playCount`, and `address(this)`
3. The result is hashed via `keccak256` to produce the final random value
4. No external oracle or pre-filled pool required

### Advantages

- **No external dependencies** (fully on-chain)
- **Synchronous gameplay** (instant results)
- **Gas efficient** (no oracle calls needed)
- **Self-sustaining** (no pool to monitor or top up)

### Considerations

- Not as strong as a VRF (block producers could theoretically bias outcomes)
- Acceptable for token distribution, not a regulated casino
- Players cannot predict outcomes before their transaction is mined

---

## Deployment

### Prerequisites

1. **DAO Wallet Addresses**:
   - Owner (multisig recommended)
   - DAO Treasury
   - Dev Wallet
2. **Sufficient PLS**: For deployment gas

### Steps

1. **Set Environment Variables** (see `.env.example`)
2. **Compile Contracts**:
   ```bash
   npx hardhat compile
   # or
   forge build
   ```
3. **Run Tests**:
   ```bash
   forge test -vvv
   # or
   npx hardhat test
   ```
4. **Deploy**:
   ```bash
   npx hardhat run scripts/deploy_pls369_system.ts --network pulsechain_testnet
   # or
   forge script script/DeployPLS369System.s.sol:DeployPLS369System --rpc-url $RPC --broadcast
   ```
5. **Verify Contracts** on block explorer
6. **Configure**: Seed jackpots
7. **Test**: Run through full gameplay cycle

See `PLS369_DEPLOYMENT_CHECKLIST.md` for detailed steps.

---

## Operational Procedures

### Initial Setup

1. **Distribute PLS369 Tokens**:
   - Transfer tokens from deployer to:
     - Liquidity Pool (for PLS/PLS369 trading)
     - DAO Treasury (long-term reserves)
     - Game Contract (for jackpot seeding)
     - Team/Contributors (vesting)

2. **Seed Jackpots**:
   ```solidity
   // As owner
   plinkoGame.seedJackpots(
     30_000_000 * 1e18,  // 30M PLS369 for main
     10_000_000 * 1e18   // 10M PLS369 for mini
   );
   ```

### Regular Maintenance

**Daily**:
- Review play activity
- Monitor jackpot levels

**Weekly**:
- Analyze game statistics
- Community updates

**Monthly**:
- DAO claims accrued rewards
- Dev claims accrued rewards
- Financial reporting

### Player Flow

1. **Acquire PLS369**:
   - Buy from DEX (PLS/PLS369 pool)
   - Receive from DAO distribution
   - Win from gameplay

2. **Approve Game Contract**:
   ```javascript
   await pls369Token.approve(gameAddress, amount);
   ```

3. **Play Game**:
   ```javascript
   await plinkoGame.play();
   ```

4. **Result**:
   - Prize slot → Instant PLS369 payout
   - Loser slot → No payout
   - Jackpot slot → Potential massive payout

---

## Frontend Integration

### Required Functionality

1. **Wallet Connection**: MetaMask or WalletConnect
2. **Token Approval**: UI for approving PLS369 spending
3. **Balance Display**: Show player PLS369 balance
4. **Game State**: Display jackpot amounts, entry price
5. **Play Button**: Send `play()` transaction
6. **Result Animation**: Puck drops to slot, shows payout
7. **History**: Recent plays, winners

### Example Code

```javascript
// Connect wallet
const provider = new BrowserProvider(window.ethereum);
const signer = await provider.getSigner();

// Get contracts
const tokenContract = new Contract(TOKEN_ADDRESS, TOKEN_ABI, signer);
const gameContract = new Contract(GAME_ADDRESS, GAME_ABI, signer);

// Check balance
const balance = await tokenContract.balanceOf(userAddress);

// Approve tokens
const approveTx = await tokenContract.approve(GAME_ADDRESS, ENTRY_PRICE);
await approveTx.wait();

// Play game
const playTx = await gameContract.play();
const receipt = await playTx.wait();

// Parse Play event
const playEvent = receipt.logs
  .map(log => gameContract.interface.parseLog(log))
  .find(event => event.name === 'Play');

const { slot, payout, mainJackpotHit, miniJackpotHit } = playEvent.args;

// Animate puck to slot
animatePuckToSlot(slot);

// Show result
if (mainJackpotHit) {
  showJackpotWin('MAIN', payout);
} else if (miniJackpotHit) {
  showJackpotWin('MINI', payout);
} else if (payout > 0) {
  showPrizeWin(payout);
} else {
  showLoss();
}
```

---

## Economics

### Token Distribution (Example)

| Allocation | Amount | Percentage | Purpose |
|------------|--------|------------|---------|
| Liquidity Pool | 147.6M | 40% | PLS/PLS369 DEX liquidity |
| DAO Treasury | 110.7M | 30% | Long-term reserves |
| Game Seeding | 55.35M | 15% | Initial jackpots |
| Team | 36.9M | 10% | Contributors (vesting) |
| Community | 18.45M | 5% | Airdrops, marketing |
| **Total** | **369M** | **100%** | Fixed supply |

### Revenue Flows

**From Gameplay**:
- DAO receives 4% of all entry fees (plus 20% of main jackpot wins)
- Dev receives 3% of all entry fees (plus 10% of mini jackpot wins)
- Main jackpot grows by 40% of entry fees
- Mini jackpot grows by 10% of entry fees

**Example (10,000 plays)**:
- Total wagered: 100,000 PLS369
- DAO earns: 4,000 PLS369 (claimable)
- Dev earns: 3,000 PLS369 (claimable)
- Main jackpot grows by: 40,000 PLS369
- Mini jackpot grows by: 10,000 PLS369

---

## Security

### Design Principles

- **Configurable Until Finalized**: Owner can adjust parameters until `finalize()` is called
- **Reentrancy Protection**: All state-changing functions protected
- **Integer Overflow**: Solidity 0.8+ (built-in checks)
- **Access Control**: Only owner can admin functions
- **Randomness**: On-chain via blockhash + timestamp + sender + playCount

### Configurable Parameters (Before Finalization)

While `finalized == false`, owner CAN change:
- DAO Treasury address
- Dev Wallet address
- Main/Mini jackpot odds
- Prize multipliers

Once `finalize()` is called, these become permanently locked.

### Immutable Parameters

These CANNOT be changed even before finalization:
- Entry price (10 PLS369)
- Token address (PLS369)

### Admin Functions

Owner can (before finalization):
- Seed jackpots (from contract balance)
- Update DAO/dev addresses
- Adjust odds and multipliers
- Emergency withdraw (for recovery)
- Transfer ownership
- Call `finalize()` to lock all settings

Owner can (after finalization):
- Seed jackpots (from contract balance)

Owner CANNOT (after finalization):
- Change any addresses, odds, or multipliers
- Withdraw player funds
- Transfer ownership

---

## Testing

Run comprehensive test suite:

```bash
# Foundry
forge test -vvv

# Hardhat
npx hardhat test
```

**Test Coverage**:
- ✅ Token minting and transfers
- ✅ Game deployment and configuration
- ✅ Play functionality
- ✅ Prize payouts
- ✅ Jackpot wins (main and mini)
- ✅ DAO and dev reward claims
- ✅ Randomness management
- ✅ Access control
- ✅ Edge cases

---

## FAQ

**Q: Why use a token instead of PLS?**
A: Tokenization allows the DAO to build liquidity, control distribution, and create a sustainable ecosystem around the game.

**Q: Can the DAO change the game rules?**
A: Only before `finalize()` is called. After finalization, all parameters are permanently locked.

**Q: How does the randomness work?**
A: The contract uses on-chain data (blockhash, timestamp, sender address, play count) to generate randomness. No external oracle is required.

**Q: Can jackpots be seeded after launch?**
A: Yes. Owner can seed jackpots at any time from the contract's PLS369 balance.

**Q: What's to prevent the owner from draining funds?**
A: Before finalization, owner can emergency withdraw. After finalization, emergency withdraw is disabled and owner can only seed jackpots.

---

## Resources

- **Contracts**: `/app/contracts/`
- **Tests**: `/app/tests/PLS369System.t.sol`
- **Deployment**: `/app/scripts/deploy_pls369_system.ts`
- **Checklist**: `/app/PLS369_DEPLOYMENT_CHECKLIST.md`

### Block Explorers
- Testnet: https://scan.v4.testnet.pulsechain.com
- Mainnet: https://scan.pulsechain.com

---

## License

MIT

---

**Built for the PLS369 DAO ecosystem.**
